globalThis.monorepoPackagePath = "";import process from 'node:process';import { Buffer } from 'node:buffer';import { createRequire as topLevelCreateRequire } from 'module';const require = topLevelCreateRequire(import.meta.url);import bannerUrl from 'url';const __dirname = bannerUrl.fileURLToPath(new URL('.', import.meta.url));globalThis.openNextDebug = false;globalThis.openNextVersion = "3.0.8";
var Xt=Object.defineProperty;var z=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var _=(e,t)=>()=>(e&&(t=e(e=0)),t);var Q=(e,t)=>{for(var r in t)Xt(e,r,{get:t[r],enumerable:!0})};function x(...e){globalThis.openNextDebug&&console.log(...e)}function Ee(...e){console.warn(...e)}function R(...e){if(e.some(t=>Vt(t)))x(...e);else if(e.some(t=>t.__openNextInternal)){let t=e.find(r=>r.__openNextInternal);if(t.logLevel===0){x(...e);return}else if(t.logLevel===1){Ee(...e);return}else{console.error(...e);return}}else console.error(...e)}var Qt,Vt,T=_(()=>{Qt=[{clientName:"S3Client",commandName:"GetObjectCommand",errorName:"NoSuchKey"}],Vt=e=>Qt.some(t=>t.clientName===e?.clientName&&t.commandName===e?.commandName&&(t.errorName===e?.error?.name||t.errorName===e?.error?.Code))});import q from"fs";import B from"path";function De(e){let t=B.join(e,"required-server-files.json"),r=q.readFileSync(t,"utf-8"),{config:s}=JSON.parse(r);return s}function ke(e){let t=B.join(e,"BUILD_ID");return q.readFileSync(t,"utf-8").trim()}function Fe(e){let t=B.join(e,"server","pages-manifest.json"),r=q.readFileSync(t,"utf-8");return Object.entries(JSON.parse(r)).filter(([s,a])=>a.endsWith(".html")).map(([s])=>s)}function qe(e){let t=B.join(e,"routes-manifest.json"),r=q.readFileSync(t,"utf-8"),s=JSON.parse(r),a=s.dataRoutes??[],o={static:a.filter(n=>n.routeKeys===void 0),dynamic:a.filter(n=>n.routeKeys!==void 0)};return{rewrites:Array.isArray(s.rewrites)?{beforeFiles:[],afterFiles:s.rewrites,fallback:[]}:{beforeFiles:s.rewrites.beforeFiles??[],afterFiles:s.rewrites.afterFiles??[],fallback:s.rewrites.fallback??[]},redirects:s.redirects??[],routes:{static:s.staticRoutes??[],dynamic:s.dynamicRoutes??[],data:o},locales:s.i18n?.locales??[]}}function Be(e){let t=B.join(e,"routes-manifest.json"),r=q.readFileSync(t,"utf-8");return JSON.parse(r).headers}function $e(e){let t=B.join(e,"prerender-manifest.json"),r=q.readFileSync(t,"utf-8");return JSON.parse(r)}function Le(e){let t=B.join(e,"server","middleware-manifest.json"),r=q.readFileSync(t,"utf-8");return JSON.parse(r)}var Ue=_(()=>{});import ze from"path";var D,Gt,N,W,We,I,Ke,Xe,Qe,$=_(()=>{T();Ue();D=ze.join(__dirname,".next"),Gt=ze.join(__dirname,".open-next");x({NEXT_DIR:D,OPEN_NEXT_DIR:Gt});N=De(D),W=ke(D),We=Fe(D),I=qe(D),Ke=Be(D),Xe=$e(D),Qe=Le(D)});function Ve(){process.env.NODE_ENV=process.env.NODE_ENV??"production"}function Ge(){return Math.random().toString(36).slice(2,8)}function Ce(e,t){return e.reduce((s,a,o)=>{let n=Math.floor(o/t);return s[n]=[...s[n]??[],a],s},new Array)}function ae(e){if(typeof e!="string")return e;let t=parseInt(e);return isNaN(t)?void 0:t}var V=_(()=>{});function ne(e){if(e)return typeof e=="string"?e.split(/(?<!Expires=\w+),/i).map(t=>t.trim()):e}var oe,Jt,ie=_(()=>{oe=e=>{let t={};if(!e)return t;for(let[r,s]of Object.entries(e))s!==void 0&&(t[r]=Jt(s));return t},Jt=e=>typeof e=="string"?e:Array.isArray(e)?e.join(","):String(e)});import{Transform as Yt}from"stream";var L,U,ce,_e=_(()=>{T();ie();L="set-cookie",U="This cannot be used in OpenNext",ce=class extends Yt{fixHeaders;streamCreator;initialHeaders;statusCode;statusMessage="";headers={};_cookies=[];responseStream;headersSent=!1;_chunks=[];strictContentLength=!1;assignSocket(t){throw new Error(U)}detachSocket(t){throw new Error(U)}writeContinue(t){throw new Error(U)}writeEarlyHints(t,r){throw new Error(U)}writeProcessing(){throw new Error(U)}req;chunkedEncoding=!1;shouldKeepAlive=!0;useChunkedEncodingByDefault=!0;sendDate=!1;connection=null;socket=null;setTimeout(t,r){throw new Error(U)}addTrailers(t){throw new Error(U)}constructor(t,r,s,a){super(),this.fixHeaders=t,this.streamCreator=s,this.initialHeaders=a,a&&a[L]&&(this._cookies=ne(a[L])),this.once("finish",()=>{this.headersSent||this.flushHeaders(),globalThis.__als?.getStore()?.pendingPromiseRunner.add(r(this.headers));let o=this.body.length;this.streamCreator?.onFinish(o)})}get originalResponse(){return this}get finished(){return!!(this.writableFinished&&this.responseStream?.writableFinished)}setHeader(t,r){let s=t.toLowerCase();return s===L&&(Array.isArray(r)?this._cookies=r:this._cookies=[r]),this.headers[s]=r,this}removeHeader(t){let r=t.toLowerCase();return r===L?this._cookies=[]:delete this.headers[r],this}hasHeader(t){let r=t.toLowerCase();return r===L?this._cookies.length>0:this.headers[r]!==void 0}getHeaders(){return this.headers}getFixedHeaders(){return this.fixHeaders(this.headers),this.headers[L]=this._cookies,this.headers}getHeader(t){return this.headers[t.toLowerCase()]}getHeaderNames(){return Object.keys(this.headers)}flushHeaders(){this.headersSent=!0,this.initialHeaders&&(this.headers={...this.headers,...this.initialHeaders}),this.fixHeaders(this.headers),this._cookies.length>0&&(this.headers[L]=this._cookies),this.streamCreator&&(this.responseStream=this.streamCreator?.writeHeaders({statusCode:this.statusCode??200,cookies:this._cookies,headers:oe(this.headers)}),this.pipe(this.responseStream))}appendHeader(t,r){let s=t.toLowerCase();if(this.hasHeader(s)){let a=this.getHeader(s),o=Array.isArray(r)?r:[r],n=Array.isArray(a)?[...a,...o]:[a,...o];return this.setHeader(s,n)}else return this.setHeader(s,r)}writeHead(t,r,s){let a=s,o;typeof r=="string"?o=r:a=r;let n=this.headers;if(a)if(Array.isArray(a))for(let i=0;i<a.length;i+=2)n[a[i]]=a[i+1];else for(let i of Object.keys(a))n[i]=a[i];return this.statusCode=t,s&&(this.headers=n),this.flushHeaders(),this}get body(){return Buffer.concat(this._chunks)}_internalWrite(t,r){this._chunks.push(Buffer.from(t,r)),this.push(t,r),this.streamCreator?.onWrite?.()}_transform(t,r,s){this.headersSent||this.flushHeaders(),this._internalWrite(t,r),s()}_flush(t){this.body.length<1&&process.env.OPEN_NEXT_FORCE_NON_EMPTY_RESPONSE==="true"&&(x('Force writing "SOMETHING" to the response body'),this.push("SOMETHING")),t()}get sent(){return this.finished||this.headersSent}getHeaderValues(t){let r=this.getHeader(t);if(r!==void 0)return(Array.isArray(r)?r:[r]).map(s=>s.toString())}send(){let t=this.body;this.end(t)}}});function Je(e){if(!e)return!1;let t=e?.split(";")[0]??"";return er.has(t)}var er,Ye=_(()=>{er=new Set(["application/octet-stream","application/epub+zip","application/msword","application/pdf","application/rtf","application/vnd.amazon.ebook","application/vnd.ms-excel","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.wordprocessingml.document","font/otf","font/woff","font/woff2","image/bmp","image/gif","image/jpeg","image/png","image/tiff","image/vnd.microsoft.icon","image/webp","audio/3gpp","audio/aac","audio/basic","audio/mpeg","audio/ogg","audio/wavaudio/webm","audio/x-aiff","audio/x-midi","audio/x-wav","video/3gpp","video/mp2t","video/mpeg","video/ogg","video/quicktime","video/webm","video/x-msvideo","application/java-archive","application/vnd.apple.installer+xml","application/x-7z-compressed","application/x-apple-diskimage","application/x-bzip","application/x-bzip2","application/x-gzip","application/x-java-archive","application/x-rar-compressed","application/x-tar","application/x-zip","application/zip"])});import tr from"node:crypto";function ue(e,t){if(!e)return!1;let r=/^https?:\/\//;return t?r.test(e)&&!e.includes(t):r.test(e)}function et(e){return e===""?{}:e.split("&").reduce((r,s)=>{let[a,o]=s.split("=");return{...r,[a]:o}},{})}function tt(e,t){if(!t){let a=/\/([^?]*)\??(.*)/,o=e.match(a);return{hostname:"",pathname:o?.[1]??e,protocol:"",queryString:o?.[2]??""}}let r=/^(https?:)\/\/?([^\/\s]+)(\/[^?]*)?(\?.*)?/,s=e.match(r);if(!s)throw new Error(`Invalid external URL: ${e}`);return{protocol:s[1]??"https:",hostname:s[2],pathname:s[3],queryString:s[4]?.slice(1)??""}}function rt(e){let t=e.statusCode||200,r=oe(e.getFixedHeaders()),s=Je(Array.isArray(r["content-type"])?r["content-type"][0]:r["content-type"]),a=s?"base64":"utf8",o=e.body.toString(a);return{statusCode:t,headers:r,body:o,isBase64Encoded:s}}function J(e){let t=new URLSearchParams;Object.entries(e).forEach(([s,a])=>{Array.isArray(a)?a.forEach(o=>t.append(s,o)):t.append(s,a)});let r=t.toString();return r?`?${r}`:""}function st(e){let t=new URLSearchParams(e),r={};for(let s of t.keys()){let a=t.getAll(s);r[s]=a.length>1?a:a[0]}return r}function at(e){let t=e.middleware["/"];return t?.matchers?t.matchers.map(({regexp:r})=>new RegExp(r)):[]}function Y(e){let t=e.replace(/\(\.\)/g,"_\xB51_");return t=t.replace(/\(\.{2}\)/g,"_\xB52_"),t=t.replace(/\(\.{3}\)/g,"_\xB53_"),t}function pe(e){let t=e.replace(/_µ1_/g,"(.)");return t=t.replace(/_µ2_/g,"(..)"),t=t.replace(/_µ3_/g,"(...)"),t}function Ze(e){let t={},r=["host","connection","via","x-cache","transfer-encoding","content-encoding"];return Object.entries(e).forEach(([s,a])=>{let o=s.toLowerCase();r.includes(o)||o.startsWith("x-amz")||(t[s]=a?.toString()??"")}),t}function ot(e,t){return e==="GET"||e==="HEAD"||!t?void 0:new ReadableStream({start(s){s.enqueue(t),s.close()}})}async function nt(e,t){let{url:r,headers:s,method:a,body:o}=e,n=await import("node:https").then(i=>i.request);x("proxyRequest",r),await new Promise((i,d)=>{let p=Ze(s);x("filteredHeaders",p);let u=n(r,{headers:p,method:a,rejectUnauthorized:!1},c=>{t.writeHead(c.statusCode??200,Ze(c.headers)),c.headers["content-encoding"]==="br"?c.pipe(z("node:zlib").createBrotliDecompress()).pipe(t):c.headers["content-encoding"]==="gzip"?c.pipe(z("node:zlib").createGunzip()).pipe(t):c.pipe(t),c.on("error",f=>{R("proxyRequest error",f),t.end(),d(f)}),c.on("end",()=>{i()})});o&&a!=="GET"&&a!=="HEAD"&&u.write(o),u.end()})}function rr(e,t){if(e==="/404"||e==="/500"){t[H.CACHE_CONTROL]="private, no-cache, no-store, max-age=0, must-revalidate";return}We.includes(e)&&(t[H.CACHE_CONTROL]="public, max-age=0, s-maxage=31536000, must-revalidate")}function sr(e){let t=e[H.CACHE_CONTROL];t&&(Array.isArray(t)&&(t=t.join(",")),typeof t=="string"&&(e[H.CACHE_CONTROL]=t.replace(/\bstale-while-revalidate(?!=)/,"stale-while-revalidate=2592000")))}function ar(e){e["X-OpenNext"]="1",globalThis.openNextDebug&&(e["X-OpenNext-Version"]=globalThis.openNextVersion,e["X-OpenNext-RequestId"]=globalThis.__als.getStore()?.requestId)}async function or(e,t,r,s){if(r[H.NEXT_CACHE]==="STALE"){let a=s?.[Symbol.for("NextInternalRequestMeta")],o=a?._nextDidRewrite?t.startsWith("/_next/data/")?`/_next/data/${W}${a?._nextRewroteUrl}.json`:a?._nextRewroteUrl:t;try{let n=u=>tr.createHash("md5").update(u).digest("hex"),i=globalThis.__als.getStore()?.requestId??"",d=globalThis.lastModified[i]>0?globalThis.lastModified[i]:"",p=r.etag??r.ETag??"";await globalThis.queue.send({MessageBody:{host:e,url:o},MessageDeduplicationId:n(`${t}-${d}-${p}`),MessageGroupId:nr(t)})}catch(n){R(`Failed to revalidate stale page ${t}`,n)}}}function nr(e){let t=ir(e);var r=t+=1831565813;r=Math.imul(r^r>>>15,r|1),r^=r+Math.imul(r^r>>>7,r|61);let s=((r^r>>>14)>>>0)/4294967296,a=parseInt(process.env.MAX_REVALIDATE_CONCURRENCY??"10");return`revalidate-${Math.floor(s*a)}`}function ir(e){let t=1779033703,r=3144134277,s=1013904242,a=2773480762;for(let o=0,n;o<e.length;o++)n=e.charCodeAt(o),t=r^Math.imul(t^n,597399067),r=s^Math.imul(r^n,2869860233),s=a^Math.imul(s^n,951274213),a=t^Math.imul(a^n,2716044179);return t=Math.imul(s^t>>>18,597399067),r=Math.imul(a^r>>>22,2869860233),s=Math.imul(t^s>>>17,951274213),a=Math.imul(r^a>>>19,2716044179),t^=r^s^a,r^=t,s^=t,a^=t,t>>>0}function cr(e){if(e[H.NEXT_CACHE]==="REVALIDATED"){e[H.CACHE_CONTROL]="private, no-cache, no-store, max-age=0, must-revalidate";return}let t=globalThis.__als.getStore()?.requestId??"",r=globalThis.lastModified[t]??0;if(e[H.NEXT_CACHE]==="HIT"&&r>0){let s=Math.round((Date.now()-r)/1e3),a=/s-maxage=(\d+)/,o=e[H.CACHE_CONTROL];if(x("cache-control",o,globalThis.lastModified,Date.now()),typeof o!="string")return;let n=o.match(a),i=n?parseInt(n[1]):void 0;if(i&&i!==31536e3){let d=Math.max(i-s,1);e[H.CACHE_CONTROL]=`s-maxage=${d}, stale-while-revalidate=2592000`}}e[H.NEXT_CACHE]==="STALE"&&(e[H.CACHE_CONTROL]="s-maxage=2, stale-while-revalidate=2592000")}function Ae(e,t,r){return new ce(s=>{rr(e.rawPath,s),sr(s),ar(s),cr(s)},async s=>{await or(e.headers.host,e.rawPath,s)},r,t)}var H,Z=_(()=>{$();_e();ie();Ye();T();(function(e){e.CACHE_CONTROL="cache-control",e.NEXT_CACHE="x-nextjs-cache"})(H||(H={}))});function bt(e){let t={};for(let[r,s]of Object.entries(e))s!==void 0&&(t[r]=s);return t}var Et=_(()=>{});var Ct={};Q(Ct,{default:()=>jr});function Tr(e){let{body:t,isBase64Encoded:r}=e;return Buffer.isBuffer(t)?t:typeof t=="string"?Buffer.from(t,r?"base64":"utf8"):typeof t=="object"?Buffer.from(JSON.stringify(t)):Buffer.from("","utf8")}function Nr(e){let{headers:t,cookies:r}=e,s={};Array.isArray(r)&&(s.cookie=r.join("; "));for(let[a,o]of Object.entries(t||{}))s[a.toLowerCase()]=o;return s}async function Hr(e){let{rawPath:t,rawQueryString:r,requestContext:s}=e;return{type:"core",method:s.http.method,rawPath:t,url:t+(r?`?${r}`:""),body:Tr(e),headers:Nr(e),remoteAddress:s.http.sourceIp,query:bt(st(r)),cookies:e.cookies?.reduce((a,o)=>{let[n,i]=o.split("=");return{...a,[n]:i}},{})??{}}}function Pr(e){let t={};Object.entries(e.headers).filter(([s])=>!Rr.some(a=>typeof a=="string"?a===s:a.test(s))).forEach(([s,a])=>{if(a==null){t[s]="";return}t[s]=Array.isArray(a)?a.join(", "):`${a}`});let r={statusCode:e.statusCode,headers:t,cookies:ne(e.headers["set-cookie"]),body:e.body,isBase64Encoded:e.isBase64Encoded};return x(r),r}var Rr,jr,_t=_(()=>{ie();T();Z();Et();Rr=["connection","expect","keep-alive","proxy-authenticate","proxy-authorization","proxy-connection","trailer","upgrade","x-accel-buffering","x-accel-charset","x-accel-limit-rate","x-accel-redirect",/x-amz-cf-(.*)/,/x-amzn-(.*)/,/x-edge-(.*)/,"x-cache","x-forwarded-proto","x-real-ip","set-cookie","age","via"];jr={convertFrom:Hr,convertTo:Pr,name:"aws-apigw-v2"}});var At={};Q(At,{default:()=>Dr});import{Writable as Mr}from"stream";function Or(e){return new Promise(t=>{setTimeout(()=>{t({serverId,type:"warmer"})},e.delay)})}var Ir,Dr,St=_(()=>{Ir=async(e,t)=>async r=>{if("type"in r)return Or(r);let s=await t.convertFrom(r),o=await e(s,{writeHeaders:()=>new Mr({write:(n,i,d)=>{d()}}),onFinish:()=>{}});return t.convertTo(o,r)},Dr={wrapper:Ir,name:"aws-lambda",supportStreaming:!1}});async function te(e,t){let r=await crypto.subtle.importKey("raw",typeof e=="string"?Pe.encode(e):e,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return crypto.subtle.sign("HMAC",r,Pe.encode(t))}async function Rt(e){return crypto.subtle.digest("SHA-256",typeof e=="string"?Pe.encode(e):e)}function He(e){let t=new Uint8Array(e),r="";for(let s=0;s<t.length;s++){let a=t[s];r+=Tt[a>>>4&15],r+=Tt[a&15]}return r}function Nt(e){return e.replace(/[!'()*]/g,t=>"%"+t.charCodeAt(0).toString(16).toUpperCase())}function qr(e,t){let{hostname:r,pathname:s}=e;if(r.endsWith(".on.aws")){let i=r.match(/^[^.]{1,63}\.lambda-url\.([^.]{1,63})\.on\.aws$/);return i!=null?["lambda",i[1]||""]:["",""]}if(r.endsWith(".r2.cloudflarestorage.com"))return["s3","auto"];if(r.endsWith(".backblazeb2.com")){let i=r.match(/^(?:[^.]{1,63}\.)?s3\.([^.]{1,63})\.backblazeb2\.com$/);return i!=null?["s3",i[1]||""]:["",""]}let a=r.replace("dualstack.","").match(/([^.]{1,63})\.(?:([^.]{0,63})\.)?amazonaws\.com(?:\.cn)?$/),o=a&&a[1]||"",n=a&&a[2];if(n==="us-gov")n="us-gov-west-1";else if(n==="s3"||n==="s3-accelerate")n="us-east-1",o="s3";else if(o==="iot")r.startsWith("iot.")?o="execute-api":r.startsWith("data.jobs.iot.")?o="iot-jobs-data":o=s==="/mqtt"?"iotdevicegateway":"iotdata";else if(o==="autoscaling"){let i=(t.get("X-Amz-Target")||"").split(".")[0];i==="AnyScaleFrontendService"?o="application-autoscaling":i==="AnyScaleScalingPlannerFrontendService"&&(o="autoscaling-plans")}else n==null&&o.startsWith("s3-")?(n=o.slice(3).replace(/^fips-|^external-1/,""),o="s3"):o.endsWith("-fips")?o=o.slice(0,-5):n&&/-\d$/.test(o)&&!/-\d$/.test(n)&&([o,n]=[n,o]);return[kr[o]||o,n||""]}var Pe,kr,Fr,F,je,Tt,he=_(()=>{Pe=new TextEncoder,kr={appstream2:"appstream",cloudhsmv2:"cloudhsm",email:"ses",marketplace:"aws-marketplace",mobile:"AWSMobileHubService",pinpoint:"mobiletargeting",queue:"sqs","git-codecommit":"codecommit","mturk-requester-sandbox":"mturk-requester","personalize-runtime":"personalize"},Fr=new Set(["authorization","content-type","content-length","user-agent","presigned-expires","expect","x-amzn-trace-id","range","connection"]),F=class{constructor({accessKeyId:t,secretAccessKey:r,sessionToken:s,service:a,region:o,cache:n,retries:i,initRetryMs:d}){if(t==null)throw new TypeError("accessKeyId is a required option");if(r==null)throw new TypeError("secretAccessKey is a required option");this.accessKeyId=t,this.secretAccessKey=r,this.sessionToken=s,this.service=a,this.region=o,this.cache=n||new Map,this.retries=i??10,this.initRetryMs=d||50}async sign(t,r){if(t instanceof Request){let{method:o,url:n,headers:i,body:d}=t;r=Object.assign({method:o,url:n,headers:i},r),r.body==null&&i.has("Content-Type")&&(r.body=d!=null&&i.has("X-Amz-Content-Sha256")?d:await t.clone().arrayBuffer()),t=n}let s=new je(Object.assign({url:t.toString()},r,this,r&&r.aws)),a=Object.assign({},r,await s.sign());delete a.aws;try{return new Request(a.url.toString(),a)}catch(o){if(o instanceof TypeError)return new Request(a.url.toString(),Object.assign({duplex:"half"},a));throw o}}async fetch(t,r){for(let s=0;s<=this.retries;s++){let a=fetch(await this.sign(t,r));if(s===this.retries)return a;let o=await a;if(o.status<500&&o.status!==429)return o;await new Promise(n=>setTimeout(n,Math.random()*this.initRetryMs*Math.pow(2,s)))}throw new Error("An unknown error occurred, ensure retries is not negative")}},je=class{constructor({method:t,url:r,headers:s,body:a,accessKeyId:o,secretAccessKey:n,sessionToken:i,service:d,region:p,cache:u,datetime:c,signQuery:f,appendSessionToken:m,allHeaders:h,singleEncode:y}){if(r==null)throw new TypeError("url is a required option");if(o==null)throw new TypeError("accessKeyId is a required option");if(n==null)throw new TypeError("secretAccessKey is a required option");this.method=t||(a?"POST":"GET"),this.url=new URL(r),this.headers=new Headers(s||{}),this.body=a,this.accessKeyId=o,this.secretAccessKey=n,this.sessionToken=i;let g,w;(!d||!p)&&([g,w]=qr(this.url,this.headers)),this.service=d||g||"",this.region=p||w||"us-east-1",this.cache=u||new Map,this.datetime=c||new Date().toISOString().replace(/[:-]|\.\d{3}/g,""),this.signQuery=f,this.appendSessionToken=m||this.service==="iotdevicegateway",this.headers.delete("Host"),this.service==="s3"&&!this.signQuery&&!this.headers.has("X-Amz-Content-Sha256")&&this.headers.set("X-Amz-Content-Sha256","UNSIGNED-PAYLOAD");let b=this.signQuery?this.url.searchParams:this.headers;if(b.set("X-Amz-Date",this.datetime),this.sessionToken&&!this.appendSessionToken&&b.set("X-Amz-Security-Token",this.sessionToken),this.signableHeaders=["host",...this.headers.keys()].filter(l=>h||!Fr.has(l)).sort(),this.signedHeaders=this.signableHeaders.join(";"),this.canonicalHeaders=this.signableHeaders.map(l=>l+":"+(l==="host"?this.url.host:(this.headers.get(l)||"").replace(/\s+/g," "))).join(`
`),this.credentialString=[this.datetime.slice(0,8),this.region,this.service,"aws4_request"].join("/"),this.signQuery&&(this.service==="s3"&&!b.has("X-Amz-Expires")&&b.set("X-Amz-Expires","86400"),b.set("X-Amz-Algorithm","AWS4-HMAC-SHA256"),b.set("X-Amz-Credential",this.accessKeyId+"/"+this.credentialString),b.set("X-Amz-SignedHeaders",this.signedHeaders)),this.service==="s3")try{this.encodedPath=decodeURIComponent(this.url.pathname.replace(/\+/g," "))}catch{this.encodedPath=this.url.pathname}else this.encodedPath=this.url.pathname.replace(/\/+/g,"/");y||(this.encodedPath=encodeURIComponent(this.encodedPath).replace(/%2F/g,"/")),this.encodedPath=Nt(this.encodedPath);let E=new Set;this.encodedSearch=[...this.url.searchParams].filter(([l])=>{if(!l)return!1;if(this.service==="s3"){if(E.has(l))return!1;E.add(l)}return!0}).map(l=>l.map(v=>Nt(encodeURIComponent(v)))).sort(([l,v],[C,j])=>l<C?-1:l>C?1:v<j?-1:v>j?1:0).map(l=>l.join("=")).join("&")}async sign(){return this.signQuery?(this.url.searchParams.set("X-Amz-Signature",await this.signature()),this.sessionToken&&this.appendSessionToken&&this.url.searchParams.set("X-Amz-Security-Token",this.sessionToken)):this.headers.set("Authorization",await this.authHeader()),{method:this.method,url:this.url,headers:this.headers,body:this.body}}async authHeader(){return["AWS4-HMAC-SHA256 Credential="+this.accessKeyId+"/"+this.credentialString,"SignedHeaders="+this.signedHeaders,"Signature="+await this.signature()].join(", ")}async signature(){let t=this.datetime.slice(0,8),r=[this.secretAccessKey,t,this.region,this.service].join(),s=this.cache.get(r);if(!s){let a=await te("AWS4"+this.secretAccessKey,t),o=await te(a,this.region),n=await te(o,this.service);s=await te(n,"aws4_request"),this.cache.set(r,s)}return He(await te(s,await this.stringToSign()))}async stringToSign(){return["AWS4-HMAC-SHA256",this.datetime,this.credentialString,He(await Rt(await this.canonicalString()))].join(`
`)}async canonicalString(){return[this.method.toUpperCase(),this.encodedPath,this.encodedSearch,this.canonicalHeaders+`
`,this.signedHeaders,await this.hexBodyHash()].join(`
`)}async hexBodyHash(){let t=this.headers.get("X-Amz-Content-Sha256")||(this.service==="s3"&&this.signQuery?"UNSIGNED-PAYLOAD":null);if(t==null){if(this.body&&typeof this.body!="string"&&!("byteLength"in this.body))throw new Error("body must be a string, ArrayBuffer or ArrayBufferView, unless you include the X-Amz-Content-Sha256 header");t=He(await Rt(this.body||""))}return t}};Tt=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"]});var me,P,ge=_(()=>{me=class extends Error{__openNextInternal=!0;canIgnore=!0;logLevel=0;constructor(t){super(t),this.name="IgnorableError"}},P=class extends Error{__openNextInternal=!0;canIgnore=!0;logLevel=1;constructor(t){super(t),this.name="RecoverableError"}}});function X(e){return async(t,r)=>{let s=await e.sign(t,r),a={};return s.headers.forEach((i,d)=>{a[d]=i}),(await globalThis.internalFetch(s.url,{method:s.method,headers:a,body:r.body})).clone()}}var ye=_(()=>{});var Ht,Pt=_(()=>{Ht=()=>{let e=process.env.DYNAMO_BATCH_WRITE_COMMAND_CONCURRENCY,t=e?parseInt(e):void 0;return t&&!isNaN(t)?t:4}});var Mt={};Q(Mt,{default:()=>Wr});import $r from"path";function se(e){return $r.posix.join(jt??"",e)}function Ur(e,t,r){return{path:{S:se(e)},tag:{S:se(t)},revalidatedAt:{N:`${r??Date.now()}`}}}var re,xe,jt,Lr,we,zr,Wr,Ot=_(()=>{he();ge();ye();T();V();Pt();({CACHE_BUCKET_REGION:re,CACHE_DYNAMO_TABLE:xe,NEXT_BUILD_ID:jt}=process.env),Lr=new F({accessKeyId:process.env.AWS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY,sessionToken:process.env.AWS_SESSION_TOKEN,region:re,retries:ae(process.env.AWS_SDK_S3_MAX_ATTEMPTS)}),we=X(Lr);zr={async getByPath(e){try{if(globalThis.disableDynamoDBCache)return[];let t=await we(`https://dynamodb.${re}.amazonaws.com`,{method:"POST",headers:{"Content-Type":"application/x-amz-json-1.0","X-Amz-Target":"DynamoDB_20120810.Query"},body:JSON.stringify({TableName:xe,IndexName:"revalidate",KeyConditionExpression:"#key = :key",ExpressionAttributeNames:{"#key":"path"},ExpressionAttributeValues:{":key":{S:se(e)}}})});if(t.status!==200)throw new P(`Failed to get tags by path: ${t.status}`);let{Items:r}=await t.json(),s=r?.map(a=>a.tag.S??"")??[];return x("tags for path",e,s),s}catch(t){return R("Failed to get tags by path",t),[]}},async getByTag(e){try{if(globalThis.disableDynamoDBCache)return[];let t=await we(`https://dynamodb.${re}.amazonaws.com`,{method:"POST",headers:{"Content-Type":"application/x-amz-json-1.0","X-Amz-Target":"DynamoDB_20120810.Query"},body:JSON.stringify({TableName:xe,KeyConditionExpression:"#tag = :tag",ExpressionAttributeNames:{"#tag":"tag"},ExpressionAttributeValues:{":tag":{S:se(e)}}})});if(t.status!==200)throw new P(`Failed to get by tag: ${t.status}`);let{Items:r}=await t.json();return r?.map(({path:{S:s}})=>s?.replace(`${jt}/`,"")??"")??[]}catch(t){return R("Failed to get by tag",t),[]}},async getLastModified(e,t){try{if(globalThis.disableDynamoDBCache)return t??Date.now();let r=await we(`https://dynamodb.${re}.amazonaws.com`,{method:"POST",headers:{"Content-Type":"application/x-amz-json-1.0","X-Amz-Target":"DynamoDB_20120810.Query"},body:JSON.stringify({TableName:xe,IndexName:"revalidate",KeyConditionExpression:"#key = :key AND #revalidatedAt > :lastModified",ExpressionAttributeNames:{"#key":"path","#revalidatedAt":"revalidatedAt"},ExpressionAttributeValues:{":key":{S:se(e)},":lastModified":{N:String(t??0)}}})});if(r.status!==200)throw new P(`Failed to get last modified: ${r.status}`);let s=(await r.json()).Items??[];return x("revalidatedTags",s),s.length>0?-1:t??Date.now()}catch(r){return R("Failed to get revalidated tags",r),t??Date.now()}},async writeTags(e){try{if(globalThis.disableDynamoDBCache)return;let t=Ce(e,25).map(s=>({RequestItems:{[xe??""]:s.map(a=>({PutRequest:{Item:{...Ur(a.path,a.tag,a.revalidatedAt)}}}))}})),r=Ce(t,Ht());for(let s of r)await Promise.all(s.map(async a=>{let o=await we(`https://dynamodb.${re}.amazonaws.com`,{method:"POST",headers:{"Content-Type":"application/x-amz-json-1.0","X-Amz-Target":"DynamoDB_20120810.BatchWriteItem"},body:JSON.stringify(a)});if(o.status!==200)throw new P(`Failed to batch write dynamo item: ${o.status}`);return o}))}catch(t){R("Failed to batch write dynamo item",t)}},name:"dynamoDb"},Wr=zr});var Dt={};Q(Dt,{default:()=>Gr});var It,Kr,Xr,Qr,Vr,Gr,kt=_(()=>{he();ge();ye();T();({REVALIDATION_QUEUE_REGION:It,REVALIDATION_QUEUE_URL:Kr}=process.env),Xr=new F({accessKeyId:process.env.AWS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY,sessionToken:process.env.AWS_SESSION_TOKEN,region:It}),Qr=X(Xr),Vr={send:async({MessageBody:e,MessageDeduplicationId:t,MessageGroupId:r})=>{try{let s=await Qr(`https://sqs.${It??"us-east-1"}.amazonaws.com`,{method:"POST",headers:{"Content-Type":"application/x-amz-json-1.0","X-Amz-Target":"AmazonSQS.SendMessage"},body:JSON.stringify({QueueUrl:Kr,MessageBody:JSON.stringify(e),MessageDeduplicationId:t,MessageGroupId:r})});if(s.status!==200)throw new P(`Failed to send message: ${s.status}`)}catch(s){R(s)}},name:"sqs"},Gr=Vr});var Ft={};Q(Ft,{default:()=>rs});import Jr from"path";function Ie(e,t){return Jr.posix.join(Yr??"",t==="fetch"?"__fetch":"",Zr??"",t==="fetch"?e:`${e}.${t}`)}var ve,Yr,Zr,Me,es,Oe,ts,rs,qt=_(()=>{he();ge();ye();V();({CACHE_BUCKET_REGION:ve,CACHE_BUCKET_KEY_PREFIX:Yr,NEXT_BUILD_ID:Zr,CACHE_BUCKET_NAME:Me}=process.env),es=new F({accessKeyId:process.env.AWS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY,sessionToken:process.env.AWS_SESSION_TOKEN,region:ve,retries:ae(process.env.AWS_SDK_S3_MAX_ATTEMPTS)}),Oe=X(es);ts={async get(e,t){let r=await Oe(`https://${Me}.s3.${ve}.amazonaws.com/${Ie(e,t?"fetch":"cache")}`,{method:"GET"});if(r.status===404)throw new me("Not found");if(r.status!==200)throw new P(`Failed to get cache: ${r.status}`);return{value:await r.json(),lastModified:new Date(r.headers.get("last-modified")??"").getTime()}},async set(e,t,r){let s=await Oe(`https://${Me}.s3.${ve}.amazonaws.com/${Ie(e,r?"fetch":"cache")}`,{method:"PUT",body:JSON.stringify(t)});if(s.status!==200)throw new P(`Failed to set cache: ${s.status}`)},async delete(e){let t=await Oe(`https://${Me}.s3.${ve}.amazonaws.com/${Ie(e,"cache")}`,{method:"DELETE"});if(t.status!==204)throw new P(`Failed to delete cache: ${t.status}`)},name:"s3"},rs=ts});$();T();V();import{AsyncLocalStorage as Ar}from"node:async_hooks";_e();import Zt from"node:http";var G=class extends Zt.IncomingMessage{constructor({method:t,url:r,headers:s,body:a,remoteAddress:o}){super({encrypted:!0,readable:!1,remoteAddress:o,address:()=>({port:443}),end:Function.prototype,destroy:Function.prototype}),typeof s["content-length"]>"u"&&(s["content-length"]=Buffer.byteLength(a).toString()),Object.assign(this,{ip:o,complete:!0,httpVersion:"1.1",httpVersionMajor:"1",httpVersionMinor:"1",method:t,headers:s,body:a,url:r}),this._read=()=>{this.push(a),this.push(null)}}};T();var de=class{resolve;reject;promise;constructor(){let t,r;this.promise=new Promise((s,a)=>{t=s,r=a}),this.resolve=t,this.reject=r}},le=class{promises=[];withResolvers(){let t=new de;return this.promises.push(t),t}add(t){let r=new de;this.promises.push(r),t.then(r.resolve,r.reject)}async await(){x(`Awaiting ${this.promises.length} detached promises`),(await Promise.allSettled(this.promises.map(s=>s.promise))).filter(s=>s.status==="rejected").forEach(s=>{R(s.reason)})}};T();Z();$();T();$();function dr(e){for(var t=[],r=0;r<e.length;){var s=e[r];if(s==="*"||s==="+"||s==="?"){t.push({type:"MODIFIER",index:r,value:e[r++]});continue}if(s==="\\"){t.push({type:"ESCAPED_CHAR",index:r++,value:e[r++]});continue}if(s==="{"){t.push({type:"OPEN",index:r,value:e[r++]});continue}if(s==="}"){t.push({type:"CLOSE",index:r,value:e[r++]});continue}if(s===":"){for(var a="",o=r+1;o<e.length;){var n=e.charCodeAt(o);if(n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122||n===95){a+=e[o++];continue}break}if(!a)throw new TypeError("Missing parameter name at ".concat(r));t.push({type:"NAME",index:r,value:a}),r=o;continue}if(s==="("){var i=1,d="",o=r+1;if(e[o]==="?")throw new TypeError('Pattern cannot start with "?" at '.concat(o));for(;o<e.length;){if(e[o]==="\\"){d+=e[o++]+e[o++];continue}if(e[o]===")"){if(i--,i===0){o++;break}}else if(e[o]==="("&&(i++,e[o+1]!=="?"))throw new TypeError("Capturing groups are not allowed at ".concat(o));d+=e[o++]}if(i)throw new TypeError("Unbalanced pattern at ".concat(r));if(!d)throw new TypeError("Missing pattern at ".concat(r));t.push({type:"PATTERN",index:r,value:d}),r=o;continue}t.push({type:"CHAR",index:r,value:e[r++]})}return t.push({type:"END",index:r,value:""}),t}function it(e,t){t===void 0&&(t={});for(var r=dr(e),s=t.prefixes,a=s===void 0?"./":s,o=t.delimiter,n=o===void 0?"/#?":o,i=[],d=0,p=0,u="",c=function(A){if(p<r.length&&r[p].type===A)return r[p++].value},f=function(A){var S=c(A);if(S!==void 0)return S;var O=r[p],be=O.type,Kt=O.index;throw new TypeError("Unexpected ".concat(be," at ").concat(Kt,", expected ").concat(A))},m=function(){for(var A="",S;S=c("CHAR")||c("ESCAPED_CHAR");)A+=S;return A},h=function(A){for(var S=0,O=n;S<O.length;S++){var be=O[S];if(A.indexOf(be)>-1)return!0}return!1},y=function(A){var S=i[i.length-1],O=A||(S&&typeof S=="string"?S:"");if(S&&!O)throw new TypeError('Must have text between two parameters, missing text after "'.concat(S.name,'"'));return!O||h(O)?"[^".concat(k(n),"]+?"):"(?:(?!".concat(k(O),")[^").concat(k(n),"])+?")};p<r.length;){var g=c("CHAR"),w=c("NAME"),b=c("PATTERN");if(w||b){var E=g||"";a.indexOf(E)===-1&&(u+=E,E=""),u&&(i.push(u),u=""),i.push({name:w||d++,prefix:E,suffix:"",pattern:b||y(E),modifier:c("MODIFIER")||""});continue}var l=g||c("ESCAPED_CHAR");if(l){u+=l;continue}u&&(i.push(u),u="");var v=c("OPEN");if(v){var E=m(),C=c("NAME")||"",j=c("PATTERN")||"",M=m();f("CLOSE"),i.push({name:C||(j?d++:""),pattern:C&&!j?y(E):j,prefix:E,suffix:M,modifier:c("MODIFIER")||""});continue}f("END")}return i}function K(e,t){return lr(it(e,t),t)}function lr(e,t){t===void 0&&(t={});var r=Re(t),s=t.encode,a=s===void 0?function(d){return d}:s,o=t.validate,n=o===void 0?!0:o,i=e.map(function(d){if(typeof d=="object")return new RegExp("^(?:".concat(d.pattern,")$"),r)});return function(d){for(var p="",u=0;u<e.length;u++){var c=e[u];if(typeof c=="string"){p+=c;continue}var f=d?d[c.name]:void 0,m=c.modifier==="?"||c.modifier==="*",h=c.modifier==="*"||c.modifier==="+";if(Array.isArray(f)){if(!h)throw new TypeError('Expected "'.concat(c.name,'" to not repeat, but got an array'));if(f.length===0){if(m)continue;throw new TypeError('Expected "'.concat(c.name,'" to not be empty'))}for(var y=0;y<f.length;y++){var g=a(f[y],c);if(n&&!i[u].test(g))throw new TypeError('Expected all "'.concat(c.name,'" to match "').concat(c.pattern,'", but got "').concat(g,'"'));p+=c.prefix+g+c.suffix}continue}if(typeof f=="string"||typeof f=="number"){var g=a(String(f),c);if(n&&!i[u].test(g))throw new TypeError('Expected "'.concat(c.name,'" to match "').concat(c.pattern,'", but got "').concat(g,'"'));p+=c.prefix+g+c.suffix;continue}if(!m){var w=h?"an array":"a string";throw new TypeError('Expected "'.concat(c.name,'" to be ').concat(w))}}return p}}function Se(e,t){var r=[],s=ct(e,r,t);return ur(s,r,t)}function ur(e,t,r){r===void 0&&(r={});var s=r.decode,a=s===void 0?function(o){return o}:s;return function(o){var n=e.exec(o);if(!n)return!1;for(var i=n[0],d=n.index,p=Object.create(null),u=function(f){if(n[f]===void 0)return"continue";var m=t[f-1];m.modifier==="*"||m.modifier==="+"?p[m.name]=n[f].split(m.prefix+m.suffix).map(function(h){return a(h,m)}):p[m.name]=a(n[f],m)},c=1;c<n.length;c++)u(c);return{path:i,index:d,params:p}}}function k(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function Re(e){return e&&e.sensitive?"":"i"}function pr(e,t){if(!t)return e;for(var r=/\((?:\?<(.*?)>)?(?!\?)/g,s=0,a=r.exec(e.source);a;)t.push({name:a[1]||s++,prefix:"",suffix:"",modifier:"",pattern:""}),a=r.exec(e.source);return e}function fr(e,t,r){var s=e.map(function(a){return ct(a,t,r).source});return new RegExp("(?:".concat(s.join("|"),")"),Re(r))}function hr(e,t,r){return mr(it(e,r),t,r)}function mr(e,t,r){r===void 0&&(r={});for(var s=r.strict,a=s===void 0?!1:s,o=r.start,n=o===void 0?!0:o,i=r.end,d=i===void 0?!0:i,p=r.encode,u=p===void 0?function(S){return S}:p,c=r.delimiter,f=c===void 0?"/#?":c,m=r.endsWith,h=m===void 0?"":m,y="[".concat(k(h),"]|$"),g="[".concat(k(f),"]"),w=n?"^":"",b=0,E=e;b<E.length;b++){var l=E[b];if(typeof l=="string")w+=k(u(l));else{var v=k(u(l.prefix)),C=k(u(l.suffix));if(l.pattern)if(t&&t.push(l),v||C)if(l.modifier==="+"||l.modifier==="*"){var j=l.modifier==="*"?"?":"";w+="(?:".concat(v,"((?:").concat(l.pattern,")(?:").concat(C).concat(v,"(?:").concat(l.pattern,"))*)").concat(C,")").concat(j)}else w+="(?:".concat(v,"(").concat(l.pattern,")").concat(C,")").concat(l.modifier);else{if(l.modifier==="+"||l.modifier==="*")throw new TypeError('Can not repeat "'.concat(l.name,'" without a prefix and suffix'));w+="(".concat(l.pattern,")").concat(l.modifier)}else w+="(?:".concat(v).concat(C,")").concat(l.modifier)}}if(d)a||(w+="".concat(g,"?")),w+=r.endsWith?"(?=".concat(y,")"):"$";else{var M=e[e.length-1],A=typeof M=="string"?g.indexOf(M[M.length-1])>-1:M===void 0;a||(w+="(?:".concat(g,"(?=").concat(y,"))?")),A||(w+="(?=".concat(g,"|").concat(y,")"))}return new RegExp(w,Re(r))}function ct(e,t,r){return e instanceof RegExp?pr(e,t):Array.isArray(e)?fr(e,t,r):hr(e,t,r)}T();Z();var lt=(e,t,r)=>s=>{switch(s.type){case"header":return!!e?.[s.key.toLowerCase()]&&new RegExp(s.value??"").test(e[s.key.toLowerCase()]??"");case"cookie":return!!t?.[s.key]&&new RegExp(s.value??"").test(t[s.key]??"");case"query":return r[s.key]&&Array.isArray(s.value)?s.value.reduce((a,o)=>a||new RegExp(o).test(r[s.key]),!1):new RegExp(s.value??"").test(r[s.key]??"");case"host":return e?.host!==""&&new RegExp(s.value??"").test(e.host);default:return!1}};function fe(e,t,r=!1){return t?t.reduce((s,a)=>s===!1?!1:r?!e(a):e(a),!0):!0}var gr=e=>t=>{x("value",t);let r=e(t);return r?r.params:{}},yr=(e,t,r)=>s=>{if(!s.value)return{};let a=new RegExp(`^${s.value}$`),o=n=>n.match(a)?.groups??{};switch(s.type){case"header":return o(e[s.key.toLowerCase()]??"");case"cookie":return o(t[s.key]??"");case"query":return Array.isArray(r[s.key])?o(r[s.key].join(",")):o(r[s.key]??"");case"host":return o(e.host??"")}};function dt(e,t,r){if(e){let{params:s}=e;return Object.keys(s).length>0?t(s):r}else return r}function ut(e,t){let r={};if(!t)return r;let{rawPath:s,headers:a,query:o,cookies:n}=e,i=lt(a,n,o),d={};for(let{headers:p,has:u,missing:c,regex:f,source:m}of t)if(new RegExp(f).test(s)&&fe(i,u)&&fe(i,c,!0)){let y=Se(m)(s);p.forEach(g=>{try{let w=dt(y,K(g.key),g.key),b=dt(y,K(g.value),g.value);d[w]=b}catch{x("Error matching header ",g.key," with value ",g.value),d[g.key]=g.value}})}return d}function ee(e,t){let{rawPath:r,headers:s,query:a,cookies:o}=e,n=lt(s,o,a),i=yr(s,o,a),d=t.find(f=>new RegExp(f.regex).test(r)&&fe(n,f.has)&&fe(n,f.missing,!0)),p=a,u=r,c=ue(d?.destination);if(x("isExternalRewrite",c),d){let{pathname:f,protocol:m,hostname:h,queryString:y}=tt(d.destination,c);x("urlParts",{pathname:f,protocol:m,hostname:h,queryString:y});let g=K(Y(f??"")??""),w=K(Y(h??"")??""),b=K(Y(y??"")??""),E={...gr(Se(Y(d?.source)??""))(r),...d.has?.reduce((M,A)=>({...M,...i(A)}),{}),...d.missing?.reduce((M,A)=>({...M,...i(A)}),{})},l=Object.keys(E).length>0,v=y,C=h,j=f;l&&(j=pe(g(E)),C=pe(w(E)),v=pe(b(E))),u=c?`${m}//${C}${j}`:`/${j}`,p={...a,...et(v)},x("rewrittenUrl",{rewrittenUrl:u,finalQuery:p,isUsingParams:l})}return{internalEvent:{...e,rawPath:u,url:`${u}${J(p)}`},__rewrite:d,isExternalRewrite:c}}function xr(e){if(new URL(e.url,"http://localhost").host!=="localhost"||N.skipTrailingSlashRedirect||e.rawPath.startsWith("/api/"))return!1;if(N.trailingSlash&&!e.headers["x-nextjs-data"]&&!e.rawPath.endsWith("/")&&!e.rawPath.match(/[\w-]+\.[\w]+$/g)){let r=e.url.split("?");return{type:e.type,statusCode:308,headers:{Location:`${r[0]}/${r[1]?`?${r[1]}`:""}`},body:"",isBase64Encoded:!1}}else if(!N.trailingSlash&&e.rawPath.endsWith("/")&&e.rawPath!=="/"){let r=e.url.split("?");return{type:e.type,statusCode:308,headers:{Location:`${r[0].replace(/\/$/,"")}${r[1]?`?${r[1]}`:""}`},body:"",isBase64Encoded:!1}}else return!1}function pt(e,t){let r=xr(e);if(r)return r;let{internalEvent:s,__rewrite:a}=ee(e,t.filter(o=>!o.internal));if(a&&!a.internal)return{type:e.type,statusCode:a.statusCode??308,headers:{Location:s.url},body:"",isBase64Encoded:!1}}function ft(e,t){let{rawPath:r,query:s}=e,a=`/_next/data/${t}`;if(r.startsWith("/_next/data")&&!r.startsWith(a))return{type:e.type,statusCode:404,body:"{}",headers:{"Content-Type":"application/json"},isBase64Encoded:!1};if(r.startsWith(a)&&r.endsWith(".json")){let o=r.replace(a,"").replace(/\.json$/,"");return o=o==="/index"?"/":o,s.__nextDataReq="1",{...e,rawPath:o,query:s,url:`${o}${J(s)}`}}return e}function ht(e,t){let{rawPath:r}=e,{dynamicRoutes:s,routes:a}=t,o=Object.entries(s).filter(([,{fallback:u}])=>u===!1).some(([,{routeRegex:u}])=>new RegExp(u).test(r)),n=N.i18n?.locales,d=n!==void 0&&n.includes(r.split("/")[1])||n===void 0?r:`/${N.i18n?.defaultLocale}${r}`,p=Object.keys(a).includes(d);return o&&!p?{event:{...e,rawPath:"/404",url:"/404",headers:{...e.headers,"x-invoke-status":"404"}},isISR:!1}:{event:e,isISR:o||p}}$();Z();var wr=Qe,vr=at(wr);function br(e){let t=e.split("/"),r=N.i18n?.locales;return(r||[]).some(s=>t[1]&&t[1].toLowerCase()===s.toLowerCase()?(t.splice(1,1),e=t.join("/")||"/",!0):!1),r&&!e.endsWith("/")?`${e}/`:e}async function mt(e){let{rawPath:t,query:r}=e,s=br(t);if(!vr.some(l=>l.test(s))||e.headers["x-isr"])return e;let o=e.headers.host?`https://${e.headers.host}`:"http://localhost:3000",n=new URL(s,o);n.search=J(r);let i=n.toString(),p=await(await import("./middleware.mjs")).default({geo:{city:e.headers["x-open-next-city"],country:e.headers["x-open-next-country"],region:e.headers["x-open-next-region"],latitude:e.headers["x-open-next-latitude"],longitude:e.headers["x-open-next-longitude"]},headers:e.headers,method:e.method||"GET",nextConfig:{basePath:N.basePath,i18n:N.i18n,trailingSlash:N.trailingSlash},url:i,body:ot(e.method,e.body)}),u=p.status,c=p.headers,f={},m={};c.delete("x-middleware-override-headers");let h="x-middleware-request-";if(c.forEach((l,v)=>{if(v.startsWith(h)){let C=v.substring(h.length);f[C]=l}else v.toLowerCase()==="set-cookie"?m[v]=m[v]?[...m[v],l]:[l]:m[v]=l}),u>=300&&u<400)return m.location=c.get("location")?.replace("http://localhost:3000",`https://${e.headers.host}`)??m.location,{body:"",type:e.type,statusCode:u,headers:m,isBase64Encoded:!1};let y=c.get("x-middleware-rewrite"),g=!1,w=!1,b=e.query,E=e.url;if(y)if(ue(y,e.headers.host))E=y,g=!0,w=!0;else{let l=new URL(y);E=l.pathname,b.__nextDataReq?b={__nextDataReq:b.__nextDataReq}:b={},l.searchParams.forEach((v,C)=>{b[C]=v}),g=!0}if(p.body){let l=await p.arrayBuffer(),v=Buffer.from(l);return{type:e.type,statusCode:u,headers:m,body:v.toString(),isBase64Encoded:!1}}return{responseHeaders:m,url:E,rawPath:g?E??e.rawPath:e.rawPath,type:e.type,headers:{...e.headers,...f},body:e.body,method:e.method,query:b,cookies:e.cookies,remoteAddress:e.remoteAddress,externalRewrite:w}}var xt=I.locales.length?`^/(?:${I.locales.map(e=>`${e}/?`).join("|")})?`:"^/",gt=I.routes.static.map(e=>new RegExp(e.regex.replace("^/",xt))),yt=I.routes.dynamic.map(e=>new RegExp(e.regex.replace("^/",xt)));async function Te(e){let t=ut(e,Ke)??{},r=ft(e,W);if("statusCode"in r)return r;let s=pt(r,I.redirects);if(s)return x("redirect",s),s;let a=await mt(r),o={};if("statusCode"in a)return a;o=a.responseHeaders||{},r=a;let n=a.externalRewrite??!1;if(!n){let h=ee(r,I.rewrites.beforeFiles);r=h.internalEvent,n=h.isExternalRewrite}let i=!n&&gt.some(h=>h.test(r.rawPath));if(!i&&!n){let h=ee(r,I.rewrites.afterFiles);r=h.internalEvent,n=h.isExternalRewrite}let{event:d,isISR:p}=ht(r,Xe);r=d;let u=!n&&yt.some(h=>h.test(r.rawPath));if(!u&&!i&&!n){let h=ee(r,I.rewrites.fallback);r=h.internalEvent,n=h.isExternalRewrite}let c=r.rawPath==="/api"||r.rawPath.startsWith("/api/"),f=r.rawPath.startsWith("/_next/image");return!(i||u||n)&&!c&&!f&&!gt.some(h=>h.test(r.rawPath))&&!yt.some(h=>h.test(r.rawPath))&&(r={...r,rawPath:"/404",url:"/404",headers:{...r.headers,"x-middleware-response-cache-control":"private, no-cache, no-store, max-age=0, must-revalidate"}}),Object.entries({...o,...t}).forEach(([h,y])=>{y&&(r.headers[`x-middleware-response-${h}`]=Array.isArray(y)?y.join(","):y)}),{internalEvent:r,isExternalRewrite:n,origin:!1,isISR:p}}$();T();import Cr from"next/dist/server/next-server.js";T();var Er=z("module"),Js=Er._resolveFilename;var _r=z.resolve("./cache.cjs"),Ne=new Cr.default({conf:{...N,compress:!1,experimental:{...N.experimental,trustHostHeader:!0,incrementalCacheHandlerPath:_r}},customServer:!1,dev:!1,dir:__dirname}).getRequestHandler();globalThis.__als=new Ar;async function vt(e,t){e.headers["x-forwarded-host"]&&(e.headers.host=e.headers["x-forwarded-host"]),x("internalEvent",e);let r={internalEvent:e,isExternalRewrite:!1,origin:!1,isISR:!1};try{r=await Te(e)}catch(o){Ee("Routing failed.",o)}let s="type"in r?r.headers:r.internalEvent.headers,a=Object.entries("type"in r?r.headers:r.internalEvent.headers).reduce((o,[n,i])=>{if(n.startsWith("x-middleware-response-")){let d=n.replace("x-middleware-response-","");return delete s[n],s[d]=i,{...o,[d]:i}}else return o},{});if("type"in r){let o=Ae(e,s,t);return o.statusCode=r.statusCode,o.flushHeaders(),o.write(r.body),o.end(),r}else{let o=r.internalEvent;x("preprocessedEvent",o);let n={method:o.method,url:o.url,headers:{...s,purpose:"prefetch"},body:o.body,remoteAddress:o.remoteAddress},i=Math.random().toString(36),d=new le;return await globalThis.__als.run({requestId:i,pendingPromiseRunner:d},async()=>{let u=r,c=new G(n),f=Ae(o,a,t);await Sr(c,f,o,u.isExternalRewrite);let{statusCode:m,headers:h,isBase64Encoded:y,body:g}=rt(f),w={type:e.type,statusCode:m,headers:h,body:g,isBase64Encoded:y};return delete globalThis.lastModified[i],await d.await(),w})}}async function Sr(e,t,r,s){delete e.body;try{let{rawPath:a}=r;if(s)return nt(r,t);await Ne(e,t)}catch(a){a.constructor.name==="NoFallbackError"?await wt("404",t,r):(R("NextJS request failed.",a),await wt("500",t,r))}}async function wt(e,t,r){try{let s=new G({method:"GET",url:`/${e}`,headers:r.headers,body:r.body,remoteAddress:r.remoteAddress});await Ne(s,t)}catch(s){R("NextJS request failed.",s),t.setHeader("Content-Type","application/json"),t.end(JSON.stringify({message:"Server failed to respond.",details:s},null,2))}}async function Bt(e){return typeof e=="function"?e():(await Promise.resolve().then(()=>(_t(),Ct))).default}async function $t(e){return typeof e=="function"?e():(await Promise.resolve().then(()=>(St(),At))).default}async function Lt(e){return typeof e=="function"?e():(await Promise.resolve().then(()=>(Ot(),Mt))).default}async function Ut(e){return typeof e=="function"?e():(await Promise.resolve().then(()=>(kt(),Dt))).default}async function zt(e){return typeof e=="function"?e():(await Promise.resolve().then(()=>(qt(),Ft))).default}async function Wt(){let e=await import(process.cwd()+"/open-next.config.mjs").then(a=>a.default),t=globalThis.fnName?e.functions[globalThis.fnName]:e.default;globalThis.serverId=Ge(),globalThis.queue=await Ut(t.override?.queue),globalThis.incrementalCache=await zt(t.override?.incrementalCache),globalThis.tagCache=await Lt(t.override?.tagCache),globalThis.lastModified={};let r=await Bt(t.override?.converter),s=await $t(t.override?.wrapper);return x("Using wrapper",s.name),s.wrapper(vt,r)}V();Ve();as();ss();globalThis.internalFetch=fetch;var Za=await Wt();function ss(){process.chdir(__dirname)}function as(){process.env.NEXT_BUILD_ID=W}export{Za as handler};
/*! Bundled license information:

aws4fetch/dist/aws4fetch.esm.mjs:
  (**
   * @license MIT <https://opensource.org/licenses/MIT>
   * @copyright Michael Hart 2024
   *)
*/
